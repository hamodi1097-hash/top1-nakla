<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .notification {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .palm-icon {
            background: linear-gradient(45deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .form-input {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(45deg, #7c3aed, #6d28d9);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4);
        }
        
        .stats-card {
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            pointer-events: none;
        }
        
        .table-row:hover {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.05), rgba(139, 92, 246, 0.05));
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            margin: 15% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Enhanced notification styles */
        .notification-achievement {
            animation: bounceIn 0.8s ease-out, glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3) translateX(100%); opacity: 0; }
            50% { transform: scale(1.05) translateX(-10%); }
            70% { transform: scale(0.9) translateX(5%); }
            100% { transform: scale(1) translateX(0); opacity: 1; }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
            to { box-shadow: 0 0 30px rgba(139, 92, 246, 0.8), 0 0 40px rgba(139, 92, 246, 0.3); }
        }
        
        .notification-celebration {
            animation: celebration 1s ease-out;
        }
        
        @keyframes celebration {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-area, .print-area * {
                visibility: visible;
            }
            
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white !important;
                color: black !important;
                font-size: 12px;
                line-height: 1.4;
            }
            
            .print-header {
                text-align: center;
                border-bottom: 2px solid #000;
                padding-bottom: 20px;
                margin-bottom: 30px;
            }
            
            .print-section {
                margin-bottom: 25px;
                page-break-inside: avoid;
            }
            
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            
            .print-table th,
            .print-table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: right;
            }
            
            .print-table th {
                background-color: #f0f0f0 !important;
                font-weight: bold;
            }
            
            .print-summary {
                border: 2px solid #000;
                padding: 15px;
                margin-top: 20px;
            }
            
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-teal-600 to-cyan-700 shadow-2xl border-b border-cyan-500/30">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-center space-x-4 space-x-reverse">
                <div class="floating-animation">
                    <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        <path d="M12 16C12 16 8 18 8 22H16C16 18 12 16 12 16Z"/>
                    </svg>
                </div>
                <div class="text-center">
                    <h1 class="text-4xl font-bold text-white mb-2">
                        <span id="headerLogoContainer" class="inline-block">
                            <span class="company-logo palm-icon">ğŸŒ´</span>
                            <img class="company-logo-image w-12 h-12 object-contain hidden inline-block align-middle rounded-lg border-2 border-white/30">
                        </span> Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø©
                    </h1>
                    <p class="text-white/80 text-lg">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±</p>
                    <div class="w-20 h-1 bg-gradient-to-r from-green-400 to-blue-500 mx-auto mt-2 rounded-full"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Logo Modal -->
    <div id="logoModal" class="modal">
        <div class="modal-content">
            <div class="bg-gradient-to-r from-purple-500 to-violet-600 text-white p-6 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold flex items-center">
                        <span class="ml-3 text-3xl">ğŸ¢</span>
                        Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©
                    </h2>
                    <button onclick="closeLogoModal()" class="text-white hover:text-gray-200 text-2xl">âœ•</button>
                </div>
            </div>
            <div class="p-8">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">ğŸ¨</div>
                    <p class="text-xl font-bold text-gray-800 mb-2">ØªØ®ØµÙŠØµ Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©</p>
                    <p class="text-gray-600">Ø§Ø®ØªØ± Ø´Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨ Ù„Ø´Ø±ÙƒØªÙƒ Ù…Ù† Ø§Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                </div>
                
                <!-- Logo Options -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('palm')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸŒ´</div>
                            <p class="text-sm font-medium">Ù†Ø®Ù„Ø© ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©</p>
                        </div>
                    </div>
                    
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('delivery')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸšš</div>
                            <p class="text-sm font-medium">Ø´Ø§Ø­Ù†Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</p>
                        </div>
                    </div>
                    
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('star')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">â­</div>
                            <p class="text-sm font-medium">Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©</p>
                        </div>
                    </div>
                    
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('crown')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸ‘‘</div>
                            <p class="text-sm font-medium">ØªØ§Ø¬ Ù…Ù„ÙƒÙŠ</p>
                        </div>
                    </div>
                    
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('diamond')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸ’</div>
                            <p class="text-sm font-medium">Ù…Ø§Ø³Ø© ÙØ§Ø®Ø±Ø©</p>
                        </div>
                    </div>
                    
                    <div class="logo-option border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-all duration-300" onclick="selectLogo('rocket')">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸš€</div>
                            <p class="text-sm font-medium">ØµØ§Ø±ÙˆØ® Ø³Ø±ÙŠØ¹</p>
                        </div>
                    </div>
                </div>
                
                <!-- Custom Logo Input -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-bold mb-3">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø´Ø¹Ø§Ø± Ù…Ø®ØµØµ:</label>
                    <input type="text" id="customLogo" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 text-center text-2xl" placeholder="ğŸ¢ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠ" maxlength="2">
                    <p class="text-sm text-gray-500 text-center mt-2">ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø£ÙŠ Ø±Ù…Ø² ØªØ¹Ø¨ÙŠØ±ÙŠ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>
                </div>
                
                <!-- Image Upload Section -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-bold mb-3">Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø´Ø¹Ø§Ø±:</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition-all duration-300">
                        <input type="file" id="logoImageInput" accept="image/*" class="hidden">
                        <div id="uploadArea" class="cursor-pointer" onclick="document.getElementById('logoImageInput').click()">
                            <div class="text-4xl mb-3">ğŸ“</div>
                            <p class="text-gray-600 font-medium mb-2">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±</p>
                            <p class="text-sm text-gray-500">PNG, JPG, GIF Ø­ØªÙ‰ 5MB</p>
                        </div>
                        <div id="imagePreviewArea" class="hidden">
                            <img id="uploadedImagePreview" class="w-20 h-20 object-contain mx-auto mb-3 rounded-lg border-2 border-gray-200">
                            <p class="text-sm text-gray-600 mb-2">ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</p>
                            <button type="button" onclick="removeUploadedImage()" class="text-red-500 hover:text-red-700 text-sm font-medium">
                                ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Preview -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <p class="text-gray-700 font-medium mb-2 text-center">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±:</p>
                    <div class="text-center">
                        <div id="logoPreviewContainer">
                            <span id="logoPreview" class="text-6xl">ğŸŒ´</span>
                            <img id="logoImagePreview" class="w-16 h-16 object-contain mx-auto hidden rounded-lg border-2 border-gray-300">
                        </div>
                        <p class="text-xl font-bold text-gray-800 mt-2">Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø©</p>
                    </div>
                </div>
                
                <div class="flex space-x-4 space-x-reverse">
                    <button type="button" onclick="closeLogoModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="button" onclick="applyLogo()" class="flex-1 btn-secondary text-white font-bold py-3 px-4 rounded-lg">
                        ğŸ¨ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø¹Ø§Ø±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <div class="bg-gradient-to-r from-red-500 to-rose-600 text-white p-6 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold flex items-center">
                        <span class="ml-3 text-3xl">âš ï¸</span>
                        ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…
                    </h2>
                    <button onclick="closeResetModal()" class="text-white hover:text-gray-200 text-2xl">âœ•</button>
                </div>
            </div>
            <div class="p-8">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">ğŸš¨</div>
                    <p class="text-xl font-bold text-gray-800 mb-2">ØªØ­Ø°ÙŠØ±: Ø¹Ù…Ù„ÙŠØ© Ø®Ø·ÙŠØ±Ø©!</p>
                    <p class="text-gray-600">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡Ø§</p>
                </div>
                <form id="resetForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-3 text-center">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©:</label>
                        <input type="password" id="resetCode" class="form-input w-full px-4 py-3 border-2 border-red-200 rounded-lg focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-center text-xl font-bold tracking-widest" placeholder="****" maxlength="4" required>
                        <p class="text-sm text-gray-500 text-center mt-2">ÙƒÙˆØ¯ Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù…</p>
                    </div>
                    <div class="flex space-x-4 space-x-reverse">
                        <button type="button" onclick="closeResetModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="flex-1 btn-danger text-white font-bold py-3 px-4 rounded-lg">
                            ğŸ—‘ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Enhanced Notifications Container -->
    <div id="notifications" class="fixed top-4 left-4 z-50 space-y-2 pointer-events-none max-w-sm">
        <!-- Notifications will be added here with pointer-events-auto -->
    </div>

    <!-- Summary Cards -->
    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="stats-card bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl p-4 text-white card-hover shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-emerald-100 text-xs font-medium">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</p>
                            <p class="text-xl font-bold mt-1" id="totalIncome">0 Ø¯.Ø¹</p>
                            <div class="flex items-center mt-1">
                                <span class="text-emerald-200 text-xs">ğŸ“ˆ Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
                            </div>
                        </div>
                        <div class="text-2xl pulse-animation">ğŸšš</div>
                    </div>
                </div>
                
                <div class="stats-card bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl p-4 text-white card-hover shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-violet-100 text-xs font-medium">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
                            <p class="text-xl font-bold mt-1" id="totalSubscriptions">0 Ø¯.Ø¹</p>
                            <div class="flex items-center mt-1">
                                <span class="text-violet-200 text-xs">ğŸ”„ Ø¯Ø®Ù„ Ø«Ø§Ø¨Øª</span>
                            </div>
                        </div>
                        <div class="text-2xl pulse-animation">ğŸ’</div>
                    </div>
                </div>
                
                <div class="stats-card bg-gradient-to-br from-rose-500 to-red-600 rounded-xl p-4 text-white card-hover shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-rose-100 text-xs font-medium">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</p>
                            <p class="text-xl font-bold mt-1" id="totalExpenses">0 Ø¯.Ø¹</p>
                            <div class="flex items-center mt-1">
                                <span class="text-rose-200 text-xs">ğŸ“‰ Ø§Ù„Ù†ÙÙ‚Ø§Øª</span>
                            </div>
                        </div>
                        <div class="text-2xl pulse-animation">ğŸ’¸</div>
                    </div>
                </div>
                
                <div class="stats-card bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl p-4 text-white card-hover shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-cyan-100 text-xs font-medium">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ</p>
                            <p class="text-xl font-bold mt-1" id="netBalance">0 Ø¯.Ø¹</p>
                            <div class="flex items-center mt-1">
                                <span class="text-cyan-200 text-xs">ğŸ’° Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                            </div>
                        </div>
                        <div class="text-2xl pulse-animation">â­</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Forms -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Daily Income -->
            <div class="glass-effect rounded-xl shadow-xl p-5 card-hover">
                <div class="text-center mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-3 floating-animation">
                        <span class="text-xl">ğŸšš</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                    <p class="text-gray-600 text-sm mt-1">Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø±Ø¯Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</p>
                </div>
                <form id="incomeForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø¯.Ø¹) <span class="text-red-500">*</span></label>
                        <input type="text" id="incomeAmount" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500/20 focus:border-green-500 text-sm" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ <span class="text-red-500">*</span></label>
                        <input type="text" id="deliveryAgent" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500/20 focus:border-green-500 text-sm" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„ <span class="text-red-500">*</span></label>
                        <input type="text" id="incomeDescription" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500/20 focus:border-green-500 text-sm" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„" required>
                    </div>
                    <button type="submit" class="btn-primary w-full text-white font-bold py-3 px-4 rounded-lg text-sm">
                        âœ… Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„
                    </button>
                </form>
            </div>

            <!-- Monthly Subscriptions -->
            <div class="glass-effect rounded-xl shadow-xl p-5 card-hover">
                <div class="text-center mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-violet-600 rounded-full flex items-center justify-center mx-auto mb-3 floating-animation">
                        <span class="text-xl">ğŸ’</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                    <p class="text-gray-600 text-sm mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©</p>
                </div>
                <form id="subscriptionForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)</label>
                        <input type="text" id="subscriptionAmount" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 text-sm" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ø³Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                        <input type="text" id="subscriptionName" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 text-sm" placeholder="Ù†ØªÙÙ„ÙŠÙƒØ³ØŒ Ø³Ø¨ÙˆØªÙŠÙØ§ÙŠØŒ Ø¥Ù„Ø®" required>
                    </div>
                    <button type="submit" class="btn-secondary w-full text-white font-bold py-3 px-4 rounded-lg text-sm">
                        ğŸ”„ Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ
                    </button>
                </form>
            </div>

            <!-- Expenses -->
            <div class="glass-effect rounded-xl shadow-xl p-5 card-hover">
                <div class="text-center mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-400 to-rose-600 rounded-full flex items-center justify-center mx-auto mb-3 floating-animation">
                        <span class="text-xl">ğŸ’¸</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                    <p class="text-gray-600 text-sm mt-1">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ÙÙ‚Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
                </div>
                <form id="expenseForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)</label>
                        <input type="text" id="expenseAmount" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-sm" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" id="expenseDescription" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-sm" placeholder="ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 text-sm">Ø§Ù„ÙØ¦Ø©</label>
                        <select id="expenseCategory" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-sm">
                            <option value="Ø§Ù†ØªØ±Ù†Øª Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†">ğŸ“± Ø§Ù†ØªØ±Ù†Øª Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</option>
                            <option value="Ø§Ù†ØªØ±Ù†Øª Ù…ÙƒØªØ¨">ğŸŒ Ø§Ù†ØªØ±Ù†Øª Ù…ÙƒØªØ¨</option>
                            <option value="Ù…ÙˆÙ„Ø¯">âš¡ Ù…ÙˆÙ„Ø¯</option>
                            <option value="Ø§ÙƒÙ„">ğŸ½ï¸ Ø§ÙƒÙ„</option>
                            <option value="Ø·Ø¨Ø§Ø¹Ø© ÙˆØµÙˆÙ„Ø§Øª">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ÙˆØµÙˆÙ„Ø§Øª</option>
                            <option value="Ø¨Ù†Ø¯ ÙˆØ±Ù‚">ğŸ“„ Ø¨Ù†Ø¯ ÙˆØ±Ù‚</option>
                            <option value="Ø­Ø¨Ø±">ğŸ–‹ï¸ Ø­Ø¨Ø±</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-danger w-full text-white font-bold py-3 px-4 rounded-lg text-sm">
                        ğŸ’¸ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
                    </button>
                </form>
            </div>
        </div>

        <!-- Monthly Statistics -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8 mb-8">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
                    <span class="ml-3 text-4xl">ğŸ“ˆ</span>
                    Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
                </h3>
                <p class="text-gray-600 mt-2">ØªØªØ¨Ø¹ Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø´Ù‡Ø±ÙŠØ§Ù‹</p>
                <div class="w-24 h-1 bg-gradient-to-r from-blue-400 to-purple-500 mx-auto mt-3 rounded-full"></div>
            </div>
            <div id="monthlyStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="text-center text-gray-500 col-span-full">
                    <div class="text-6xl mb-4">ğŸ“Š</div>
                    <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø±ÙŠØ© Ø¨Ø¹Ø¯</p>
                    <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                </div>
            </div>
        </div>

        <!-- Delivery Agents Statistics -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8 mb-8">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
                    <span class="ml-3 text-4xl">ğŸ‘¥</span>
                    Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
                </h3>
                <p class="text-gray-600 mt-2">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</p>
                <div class="w-24 h-1 bg-gradient-to-r from-green-400 to-blue-500 mx-auto mt-3 rounded-full"></div>
            </div>
            <div id="agentsStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="text-center text-gray-500 col-span-full">
                    <div class="text-6xl mb-4">ğŸ‘¤</div>
                    <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø¨Ø¹Ø¯</p>
                    <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ ÙˆØµÙ„ Ù„Ù…Ù†Ø¯ÙˆØ¨</p>
                </div>
            </div>
        </div>

        <!-- Transactions History -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
                    <span class="ml-3 text-4xl">ğŸ“Š</span>
                    Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                </h3>
                <p class="text-gray-600 mt-2">ØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                <div class="w-24 h-1 bg-gradient-to-r from-blue-400 to-purple-500 mx-auto mt-3 rounded-full"></div>
            </div>
            <div class="flex justify-center mb-6 space-x-4 space-x-reverse">
                <button onclick="showLogoModal()" class="btn-secondary px-6 py-3 text-white font-bold rounded-lg text-sm hover:shadow-lg transition-all duration-300">
                    ğŸ¢ Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©
                </button>
                <button onclick="printMonthlyReport()" class="btn-primary px-6 py-3 text-white font-bold rounded-lg text-sm hover:shadow-lg transition-all duration-300">
                    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
                </button>
                <button onclick="showResetModal()" class="btn-danger px-6 py-3 text-white font-bold rounded-lg text-sm hover:shadow-lg transition-all duration-300">
                    ğŸ—‘ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…
                </button>
            </div>
            <div class="overflow-x-auto rounded-xl">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gradient-to-r from-gray-50 to-gray-100">
                            <th class="px-6 py-4 text-right text-gray-700 font-bold text-lg">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="px-6 py-4 text-right text-gray-700 font-bold text-lg">ğŸ·ï¸ Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="px-6 py-4 text-right text-gray-700 font-bold text-lg">ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
                            <th class="px-6 py-4 text-right text-gray-700 font-bold text-lg">ğŸ“ Ø§Ù„ÙˆØµÙ</th>
                            <th class="px-6 py-4 text-right text-gray-700 font-bold text-lg">ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº</th>

                        </tr>
                    </thead>
                    <tbody id="transactionsTable">
                        <tr>
                            <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                                <div class="flex flex-col items-center">
                                    <div class="text-6xl mb-4">ğŸ“‹</div>
                                    <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø§Ù„ÙŠØ© Ø¨Ø¹Ø¯</p>
                                    <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù…Ø§Ù„ÙŠØ©</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Hidden Print Area -->
    <div id="printArea" class="print-area" style="display: none;">
        <!-- Print content will be generated here -->
    </div>

    <script>
        // Data storage
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let totals = {
            income: 0,
            expenses: 0,
            subscriptions: 0
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            calculateTotals();
            updateDisplay();
            renderTransactions();
            renderMonthlyStats();
            renderAgentsStats();
            loadCompanyLogo();
            
            // Initialize smart notifications
            setTimeout(() => {
                checkSpecialOccasions();
                checkTimeBasedNotifications();
                showWelcomeMessage();
            }, 2000);
            
            // Check notifications periodically
            setInterval(() => {
                checkTimeBasedNotifications();
                checkWeatherNotifications();
            }, 300000); // Every 5 minutes
        });

        // Print Monthly Report Function
        function printMonthlyReport() {
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            const monthNames = [
                'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
                'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
            ];
            
            // Filter transactions for current month
            const monthlyTransactions = transactions.filter(t => {
                const tDate = new Date(t.timestamp);
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });
            
            if (monthlyTransactions.length === 0) {
                showNotification('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©!', 'error');
                return;
            }
            
            // Calculate monthly statistics
            const monthlyStats = {
                deliveries: 0,
                deliveriesAmount: 0,
                subscriptions: 0,
                subscriptionsAmount: 0,
                expenses: 0,
                expensesAmount: 0
            };
            
            const agentStats = {};
            const expenseCategories = {};
            
            monthlyTransactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    if (transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ')) {
                        monthlyStats.subscriptions++;
                        monthlyStats.subscriptionsAmount += transaction.amount;
                    } else {
                        monthlyStats.deliveries++;
                        monthlyStats.deliveriesAmount += transaction.amount;
                        
                        // Agent statistics
                        if (transaction.agent) {
                            if (!agentStats[transaction.agent]) {
                                agentStats[transaction.agent] = { count: 0, amount: 0 };
                            }
                            agentStats[transaction.agent].count++;
                            agentStats[transaction.agent].amount += transaction.amount;
                        }
                    }
                } else if (transaction.type === 'expense') {
                    monthlyStats.expenses++;
                    monthlyStats.expensesAmount += transaction.amount;
                    
                    // Expense categories
                    const category = transaction.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    if (!expenseCategories[category]) {
                        expenseCategories[category] = { count: 0, amount: 0 };
                    }
                    expenseCategories[category].count++;
                    expenseCategories[category].amount += transaction.amount;
                }
            });
            
            const totalIncome = monthlyStats.deliveriesAmount + monthlyStats.subscriptionsAmount;
            const netProfit = totalIncome - monthlyStats.expensesAmount;
            
            // Generate print content
            const logoDisplay = companyLogoType === 'image' && companyLogoImage ? 
                `<img src="${companyLogoImage}" style="width: 40px; height: 40px; object-fit: contain; display: inline-block; vertical-align: middle; margin-left: 10px; border-radius: 5px;">` : 
                companyLogo;
            
            const printContent = `
                <div class="print-header">
                    <h1 style="font-size: 24px; margin-bottom: 10px;">${logoDisplay} Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø© Ù„Ù„ØªÙˆØµÙŠÙ„</h1>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2>
                    <h3 style="font-size: 16px; color: #666;">${monthNames[currentMonth]} ${currentYear}</h3>
                    <p style="margin-top: 10px; font-size: 12px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-EG')} - ${new Date().toLocaleTimeString('ar-EG')}</p>
                </div>
                
                <div class="print-section">
                    <h3 style="font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #000; padding-bottom: 5px;">ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>
                    <div class="print-summary">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª (${monthlyStats.deliveries} ÙˆØµÙ„)</td>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: left; font-weight: bold;">${monthlyStats.deliveriesAmount.toLocaleString()} Ø¯.Ø¹</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; font-weight: bold;">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (${monthlyStats.subscriptions} Ø§Ø´ØªØ±Ø§Ùƒ)</td>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: left; font-weight: bold;">${monthlyStats.subscriptionsAmount.toLocaleString()} Ø¯.Ø¹</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; font-weight: bold; color: #059669;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</td>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: left; font-weight: bold; color: #059669;">${totalIncome.toLocaleString()} Ø¯.Ø¹</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; font-weight: bold; color: #dc2626;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª (${monthlyStats.expenses} Ù…ØµØ±ÙˆÙ)</td>
                                <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: left; font-weight: bold; color: #dc2626;">${monthlyStats.expensesAmount.toLocaleString()} Ø¯.Ø¹</td>
                            </tr>
                            <tr style="background-color: #f0f0f0;">
                                <td style="padding: 12px; font-weight: bold; font-size: 14px; color: ${netProfit >= 0 ? '#059669' : '#dc2626'};">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</td>
                                <td style="padding: 12px; text-align: left; font-weight: bold; font-size: 14px; color: ${netProfit >= 0 ? '#059669' : '#dc2626'};">${netProfit.toLocaleString()} Ø¯.Ø¹</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                ${Object.keys(agentStats).length > 0 ? `
                <div class="print-section">
                    <h3 style="font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #000; padding-bottom: 5px;">ğŸ‘¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h3>
                    <table class="print-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØµÙ„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(agentStats)
                                .sort(([,a], [,b]) => b.count - a.count)
                                .map(([agent, stats]) => `
                                <tr>
                                    <td>${agent}</td>
                                    <td>${stats.count}</td>
                                    <td>${stats.amount.toLocaleString()} Ø¯.Ø¹</td>
                                    <td>${Math.round(stats.amount / stats.count).toLocaleString()} Ø¯.Ø¹</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
                
                ${Object.keys(expenseCategories).length > 0 ? `
                <div class="print-section">
                    <h3 style="font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #000; padding-bottom: 5px;">ğŸ’¸ ØªÙØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                    <table class="print-table">
                        <thead>
                            <tr>
                                <th>ÙØ¦Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(expenseCategories)
                                .sort(([,a], [,b]) => b.amount - a.amount)
                                .map(([category, stats]) => `
                                <tr>
                                    <td>${category}</td>
                                    <td>${stats.count}</td>
                                    <td>${stats.amount.toLocaleString()} Ø¯.Ø¹</td>
                                    <td>${((stats.amount / monthlyStats.expensesAmount) * 100).toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
                
                <div class="print-section">
                    <h3 style="font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #000; padding-bottom: 5px;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
                    <table class="print-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${monthlyTransactions.map(transaction => {
                                const typeText = transaction.type === 'income' ? 
                                    (transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ') ? 'Ø§Ø´ØªØ±Ø§Ùƒ' : 'ÙˆØµÙ„') : 'Ù…ØµØ±ÙˆÙ';
                                return `
                                <tr>
                                    <td>${transaction.date}</td>
                                    <td>${typeText}</td>
                                    <td>${transaction.agent || '-'}</td>
                                    <td>${transaction.description}</td>
                                    <td style="color: ${transaction.type === 'expense' ? '#dc2626' : '#059669'};">${transaction.amount.toLocaleString()} Ø¯.Ø¹</td>
                                </tr>
                            `;}).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ccc; padding-top: 15px;">
                    <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø© Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                    <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
            `;
            
            // Set print content and trigger print
            document.getElementById('printArea').innerHTML = printContent;
            document.getElementById('printArea').style.display = 'block';
            
            // Show notification and print
            showNotification('ğŸ–¨ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©...', 'info', 3000);
            
            setTimeout(() => {
                window.print();
                
                // Hide print area after printing
                setTimeout(() => {
                    document.getElementById('printArea').style.display = 'none';
                }, 1000);
            }, 500);
        }

        // Enhanced notification system with smart alerts
        function showNotification(message, type = 'success', duration = 5000, sound = true) {
            const notification = document.createElement('div');
            const isSpecial = type === 'achievement' || type === 'celebration';
            
            notification.className = `notification px-6 py-4 rounded-xl shadow-2xl text-white pointer-events-auto ${
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 
                type === 'error' ? 'bg-gradient-to-r from-red-500 to-rose-600' : 
                type === 'info' ? 'bg-gradient-to-r from-blue-500 to-cyan-600' : 
                type === 'warning' ? 'bg-gradient-to-r from-orange-500 to-amber-600' :
                type === 'achievement' ? 'bg-gradient-to-r from-purple-500 to-pink-600 notification-achievement' :
                type === 'celebration' ? 'bg-gradient-to-r from-yellow-400 to-orange-500 notification-celebration' :
                'bg-gradient-to-r from-purple-500 to-violet-600'
            }`;
            
            // Play notification sound
            if (sound) {
                playNotificationSound(type);
            }
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="text-2xl ml-3 ${isSpecial ? 'animate-bounce' : ''}">${getNotificationIcon(type)}</span>
                        <span class="font-medium">${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="mr-4 text-white hover:text-gray-200 text-xl">âœ•</button>
                </div>
            `;
            
            document.getElementById('notifications').appendChild(notification);
            
            // Auto remove after specified duration
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 500);
                }
            }, duration);
        }

        // Get notification icon based on type
        function getNotificationIcon(type) {
            const icons = {
                'success': 'âœ…',
                'error': 'âŒ',
                'info': 'â„¹ï¸',
                'warning': 'âš ï¸',
                'achievement': 'ğŸ†',
                'milestone': 'ğŸ¯',
                'celebration': 'ğŸ‰'
            };
            return icons[type] || 'ğŸ“¢';
        }

        // Play notification sound (using Web Audio API for better browser support)
        function playNotificationSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different frequencies for different notification types
                const frequencies = {
                    'success': [523, 659, 784], // C-E-G chord
                    'error': [220, 185], // Low warning tones
                    'info': [440], // Single A note
                    'warning': [330, 370], // Warning beeps
                    'achievement': [523, 659, 784, 1047], // Victory fanfare
                    'celebration': [392, 523, 659, 784, 1047] // Full celebration
                };
                
                const freqs = frequencies[type] || [440];
                
                freqs.forEach((freq, index) => {
                    setTimeout(() => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        
                        osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                        osc.type = type === 'achievement' || type === 'celebration' ? 'sine' : 'square';
                        
                        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        
                        osc.start(audioContext.currentTime);
                        osc.stop(audioContext.currentTime + 0.2);
                    }, index * 100);
                });
            } catch (e) {
                // Fallback for browsers that don't support Web Audio API
                console.log('Audio notification not supported');
            }
        }

        // Welcome message
        function showWelcomeMessage() {
            const hour = new Date().getHours();
            let greeting = '';
            
            if (hour < 12) {
                greeting = 'ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±! ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„ÙØ±Øµ!';
            } else if (hour < 17) {
                greeting = 'â˜€ï¸ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø§Ø¦Ø¹!';
            } else {
                greeting = 'ğŸŒ† Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ØŸ';
            }
            
            setTimeout(() => {
                showNotification(greeting, 'info', 4000);
            }, 1000);
        }

        // Smart notification system
        function checkSmartNotifications() {
            checkDailyGoals();
            checkMilestones();
            checkWarnings();
            checkEncouragement();
        }

        // Check daily goals
        function checkDailyGoals() {
            const today = new Date().toDateString();
            const todayTransactions = transactions.filter(t => new Date(t.timestamp).toDateString() === today);
            const todayDeliveries = todayTransactions.filter(t => t.type === 'income' && !t.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ'));
            
            if (todayDeliveries.length === 10) {
                showNotification('ğŸ¯ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù€ 10 ÙˆØµÙˆÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…!', 'milestone', 7000);
            } else if (todayDeliveries.length === 25) {
                showNotification('ğŸ”¥ Ø±Ø§Ø¦Ø¹! 25 ÙˆØµÙ„ ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯! Ø£Ø¯Ø§Ø¡ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ!', 'achievement', 8000);
            } else if (todayDeliveries.length === 50) {
                showNotification('ğŸ‘‘ Ø£Ø³Ø·ÙˆØ±ÙŠ! 50 ÙˆØµÙ„ ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯! Ø£Ù†Øª Ø¨Ø·Ù„!', 'celebration', 10000);
            }
        }

        // Check milestones
        function checkMilestones() {
            const totalDeliveries = transactions.filter(t => t.type === 'income' && !t.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ')).length;
            const totalRevenue = totals.income + totals.subscriptions;
            
            // Delivery milestones
            if (totalDeliveries === 100) {
                showNotification('ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„ÙˆØµÙ„ Ø±Ù‚Ù… 100!', 'achievement', 8000);
            } else if (totalDeliveries === 500) {
                showNotification('ğŸ† Ø¥Ù†Ø¬Ø§Ø² Ø±Ø§Ø¦Ø¹! 500 ÙˆØµÙ„ Ù…ÙƒØªÙ…Ù„!', 'achievement', 8000);
            } else if (totalDeliveries === 1000) {
                showNotification('ğŸ‘‘ Ø£Ù„Ù Ù…Ø¨Ø±ÙˆÙƒ! 1000 ÙˆØµÙ„! Ø¥Ù†Ø¬Ø§Ø² ØªØ§Ø±ÙŠØ®ÙŠ!', 'celebration', 10000);
            }
            
            // Revenue milestones
            if (totalRevenue >= 1000000 && totalRevenue < 1010000) {
                showNotification('ğŸ’° Ù…Ù„ÙŠÙˆÙ† Ø¯ÙŠÙ†Ø§Ø±! Ø¥Ù†Ø¬Ø§Ø² Ù…Ø§Ù„ÙŠ Ø±Ø§Ø¦Ø¹!', 'achievement', 8000);
            } else if (totalRevenue >= 5000000 && totalRevenue < 5010000) {
                showNotification('ğŸ’ 5 Ù…Ù„ÙŠÙˆÙ† Ø¯ÙŠÙ†Ø§Ø±! Ù†Ù…Ùˆ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ!', 'celebration', 10000);
            }
        }

        // Check warnings
        function checkWarnings() {
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthlyExpenses = transactions.filter(t => {
                const tDate = new Date(t.timestamp);
                return t.type === 'expense' && tDate.getMonth() === thisMonth && tDate.getFullYear() === thisYear;
            }).reduce((sum, t) => sum + t.amount, 0);
            
            const monthlyIncome = transactions.filter(t => {
                const tDate = new Date(t.timestamp);
                return t.type === 'income' && tDate.getMonth() === thisMonth && tDate.getFullYear() === thisYear;
            }).reduce((sum, t) => sum + t.amount, 0);
            
            // High expenses warning
            if (monthlyExpenses > monthlyIncome * 0.7 && monthlyIncome > 0) {
                showNotification('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¹Ø§Ù„ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', 'warning', 8000);
            }
            
            // Low activity warning
            const today = new Date().toDateString();
            const todayTransactions = transactions.filter(t => new Date(t.timestamp).toDateString() === today);
            if (todayTransactions.length === 0 && new Date().getHours() > 12) {
                showNotification('ğŸ“ ØªØ°ÙƒÙŠØ±: Ù„Ù… ØªØ³Ø¬Ù„ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯', 'info', 6000);
            }
        }

        // Encouraging messages
        function checkEncouragement() {
            const encouragingMessages = [
                'ğŸ’ª Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø§Ø¦Ø¹!',
                'ğŸŒŸ ÙƒÙ„ ÙˆØµÙ„ ÙŠÙ‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù†Ø¬Ø§Ø­!',
                'ğŸš€ Ø´Ø±ÙƒØ© Ù†Ø®Ù„Ø© ÙÙŠ Ù†Ù…Ùˆ Ù…Ø³ØªÙ…Ø±!',
                'â­ Ø£Ø¯Ø§Ø¤Ùƒ Ø§Ù„ÙŠÙˆÙ… Ù…Ù…ØªØ§Ø²!',
                'ğŸ¯ Ù‡Ø¯ÙÙƒ Ø§Ù„Ù‚Ø§Ø¯Ù… ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚!',
                'ğŸ’ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ù‡ÙŠ Ø³Ø± Ø§Ù„Ù†Ø¬Ø§Ø­!',
                'ğŸ† Ø£Ù†Øª ØªØ¨Ù†ÙŠ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„!',
                'ğŸŒ´ Ù†Ø®Ù„Ø© ØªÙ†Ù…Ùˆ Ø¨ÙØ¶Ù„ Ø¬Ù‡ÙˆØ¯Ùƒ!'
            ];
            
            // Show encouraging message randomly (3% chance per transaction)
            if (Math.random() < 0.03) {
                const randomMessage = encouragingMessages[Math.floor(Math.random() * encouragingMessages.length)];
                setTimeout(() => {
                    showNotification(randomMessage, 'info', 4000);
                }, 2000);
            }
        }

        // Time-based notifications
        function checkTimeBasedNotifications() {
            const hour = new Date().getHours();
            const lastShownToday = localStorage.getItem('lastTimeNotification');
            const today = new Date().toDateString();
            
            if (lastShownToday !== today) {
                if (hour === 8) {
                    showNotification('ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±! ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„ÙØ±Øµ!', 'info', 6000);
                    localStorage.setItem('lastTimeNotification', today);
                } else if (hour === 12) {
                    showNotification('â˜€ï¸ ÙˆÙ‚Øª Ø§Ù„ØºØ¯Ø§Ø¡! Ù„Ø§ ØªÙ†Ø³ Ø£Ø®Ø° Ø§Ø³ØªØ±Ø§Ø­Ø©', 'info', 5000);
                    localStorage.setItem('lastTimeNotification', today);
                } else if (hour === 18) {
                    showNotification('ğŸŒ† Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ØŸ', 'info', 5000);
                    localStorage.setItem('lastTimeNotification', today);
                }
            }
        }

        // Weather-based notifications (simulated)
        function checkWeatherNotifications() {
            const weatherMessages = [
                'ğŸŒ§ï¸ Ø§Ù„Ø·Ù‚Ø³ Ù…Ù…Ø·Ø± Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ø³Ù„Ø§Ù…Ø©!',
                'â˜€ï¸ Ø·Ù‚Ø³ Ù…Ø´Ù…Ø³ Ø±Ø§Ø¦Ø¹ Ù„Ù„Ø¹Ù…Ù„!',
                'ğŸŒªï¸ Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ©ØŒ ÙƒÙ† Ø­Ø°Ø±Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚!',
                'â„ï¸ Ø·Ù‚Ø³ Ø¨Ø§Ø±Ø¯ØŒ Ø§Ù„Ø¨Ø³ Ù…Ù„Ø§Ø¨Ø³ Ø¯Ø§ÙØ¦Ø©!',
                'ğŸŒ¡ï¸ Ø­Ø± Ø´Ø¯ÙŠØ¯ØŒ Ø§Ø´Ø±Ø¨ Ù…Ø§Ø¡ ÙƒØ«ÙŠØ±!'
            ];
            
            // Show weather notification randomly (1% chance)
            if (Math.random() < 0.01) {
                const randomWeather = weatherMessages[Math.floor(Math.random() * weatherMessages.length)];
                setTimeout(() => {
                    showNotification(randomWeather, 'info', 6000);
                }, 3000);
            }
        }

        // Special occasion notifications
        function checkSpecialOccasions() {
            const today = new Date();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            // Iraqi holidays and special days
            const occasions = {
                '1-1': 'ğŸŠ ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±! Ø³Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø³Ø¹ÙŠØ¯Ø©!',
                '7-14': 'ğŸ‡®ğŸ‡¶ Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ© Ø§Ù„Ù…Ø¬ÙŠØ¯!',
                '4-9': 'ğŸ›ï¸ Ø°ÙƒØ±Ù‰ Ø³Ù‚ÙˆØ· Ø§Ù„Ù†Ø¸Ø§Ù… - ÙŠÙˆÙ… Ø§Ù„ØªØ­Ø±ÙŠØ±',
                '10-3': 'ğŸ‡®ğŸ‡¶ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ',
                '12-25': 'ğŸ„ ÙƒØ±ÙŠØ³Ù…Ø§Ø³ Ù…Ø¬ÙŠØ¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø³ÙŠØ­ÙŠÙŠÙ†!'
            };
            
            const todayKey = `${month}-${day}`;
            if (occasions[todayKey]) {
                const lastShown = localStorage.getItem('lastOccasionNotification');
                if (lastShown !== todayKey) {
                    setTimeout(() => {
                        showNotification(occasions[todayKey], 'celebration', 8000);
                        localStorage.setItem('lastOccasionNotification', todayKey);
                    }, 1000);
                }
            }
        }

        // Show reset modal
        function showResetModal() {
            document.getElementById('resetModal').style.display = 'block';
            document.getElementById('resetCode').focus();
        }

        // Close reset modal
        function closeResetModal() {
            document.getElementById('resetModal').style.display = 'none';
            document.getElementById('resetForm').reset();
        }

        // Handle reset form
        document.getElementById('resetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('resetCode').value;
            
            if (code === '1097') {
                // Clear all data
                transactions = [];
                localStorage.removeItem('transactions');
                
                // Reset display
                calculateTotals();
                updateDisplay();
                renderTransactions();
                renderMonthlyStats();
                renderAgentsStats();
                
                closeResetModal();
                showNotification('ğŸ—‘ï¸ ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø°ÙˆÙØ©.', 'success');
            } else {
                showNotification('âŒ ÙƒÙˆØ¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø®Ø§Ø·Ø¦! ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
                document.getElementById('resetCode').value = '';
                document.getElementById('resetCode').focus();
            }
        });

        // Logo Management Functions
        let selectedLogo = 'ğŸŒ´';
        let selectedLogoType = 'emoji'; // 'emoji' or 'image'
        let selectedImageData = null;
        let companyLogo = localStorage.getItem('companyLogo') || 'ğŸŒ´';
        let companyLogoType = localStorage.getItem('companyLogoType') || 'emoji';
        let companyLogoImage = localStorage.getItem('companyLogoImage') || null;

        // Load company logo
        function loadCompanyLogo() {
            if (companyLogoType === 'image' && companyLogoImage) {
                // Show image logo
                const logoElements = document.querySelectorAll('.company-logo');
                const logoImageElements = document.querySelectorAll('.company-logo-image');
                
                logoElements.forEach(element => {
                    element.style.display = 'none';
                });
                
                logoImageElements.forEach(element => {
                    element.src = companyLogoImage;
                    element.classList.remove('hidden');
                    element.style.display = 'inline-block';
                });
            } else {
                // Show emoji logo
                const logoElements = document.querySelectorAll('.company-logo');
                const logoImageElements = document.querySelectorAll('.company-logo-image');
                
                logoElements.forEach(element => {
                    element.textContent = companyLogo;
                    element.style.display = 'inline';
                });
                
                logoImageElements.forEach(element => {
                    element.classList.add('hidden');
                    element.style.display = 'none';
                });
            }
        }

        // Show logo modal
        function showLogoModal() {
            document.getElementById('logoModal').style.display = 'block';
            selectedLogo = companyLogo;
            selectedLogoType = companyLogoType;
            selectedImageData = companyLogoImage;
            
            // Update preview
            updateLogoPreview();
            
            // Clear previous selections
            document.querySelectorAll('.logo-option').forEach(option => {
                option.classList.remove('border-purple-500', 'bg-purple-50');
                option.classList.add('border-gray-200');
            });
            
            // Clear custom input and image upload
            document.getElementById('customLogo').value = '';
            resetImageUpload();
        }

        // Close logo modal
        function closeLogoModal() {
            document.getElementById('logoModal').style.display = 'none';
        }

        // Select predefined logo
        function selectLogo(logoType) {
            const logos = {
                'palm': 'ğŸŒ´',
                'delivery': 'ğŸšš',
                'star': 'â­',
                'crown': 'ğŸ‘‘',
                'diamond': 'ğŸ’',
                'rocket': 'ğŸš€'
            };
            
            selectedLogo = logos[logoType];
            selectedLogoType = 'emoji';
            selectedImageData = null;
            
            updateLogoPreview();
            document.getElementById('customLogo').value = '';
            resetImageUpload();
            
            // Update visual selection
            document.querySelectorAll('.logo-option').forEach(option => {
                option.classList.remove('border-purple-500', 'bg-purple-50');
                option.classList.add('border-gray-200');
            });
            
            event.target.closest('.logo-option').classList.remove('border-gray-200');
            event.target.closest('.logo-option').classList.add('border-purple-500', 'bg-purple-50');
        }

        // Handle custom logo input
        document.getElementById('customLogo').addEventListener('input', function() {
            if (this.value.trim()) {
                selectedLogo = this.value.trim();
                selectedLogoType = 'emoji';
                selectedImageData = null;
                
                updateLogoPreview();
                resetImageUpload();
                
                // Clear predefined selections
                document.querySelectorAll('.logo-option').forEach(option => {
                    option.classList.remove('border-purple-500', 'bg-purple-50');
                    option.classList.add('border-gray-200');
                });
            }
        });

        // Apply selected logo
        function applyLogo() {
            if (selectedLogoType === 'emoji' && (!selectedLogo || selectedLogo.trim() === '')) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø¹Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹!', 'error');
                return;
            }
            
            if (selectedLogoType === 'image' && !selectedImageData) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹!', 'error');
                return;
            }
            
            // Save logo data
            companyLogo = selectedLogo;
            companyLogoType = selectedLogoType;
            companyLogoImage = selectedImageData;
            
            localStorage.setItem('companyLogo', companyLogo);
            localStorage.setItem('companyLogoType', companyLogoType);
            if (companyLogoImage) {
                localStorage.setItem('companyLogoImage', companyLogoImage);
            } else {
                localStorage.removeItem('companyLogoImage');
            }
            
            // Update all logo elements
            loadCompanyLogo();
            
            closeLogoModal();
            
            const logoDisplay = selectedLogoType === 'image' ? 'ØµÙˆØ±Ø© Ù…Ø®ØµØµØ©' : selectedLogo;
            showNotification(`ğŸ¨ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ${logoDisplay} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        }

        // Image upload functions
        function updateLogoPreview() {
            const logoPreview = document.getElementById('logoPreview');
            const logoImagePreview = document.getElementById('logoImagePreview');
            
            if (selectedLogoType === 'image' && selectedImageData) {
                logoPreview.style.display = 'none';
                logoImagePreview.src = selectedImageData;
                logoImagePreview.classList.remove('hidden');
            } else {
                logoPreview.textContent = selectedLogo;
                logoPreview.style.display = 'inline';
                logoImagePreview.classList.add('hidden');
            }
        }
        
        function resetImageUpload() {
            document.getElementById('logoImageInput').value = '';
            document.getElementById('uploadArea').classList.remove('hidden');
            document.getElementById('imagePreviewArea').classList.add('hidden');
        }
        
        function removeUploadedImage() {
            selectedImageData = null;
            selectedLogoType = 'emoji';
            resetImageUpload();
            updateLogoPreview();
            
            // Clear other selections
            document.getElementById('customLogo').value = '';
            document.querySelectorAll('.logo-option').forEach(option => {
                option.classList.remove('border-purple-500', 'bg-purple-50');
                option.classList.add('border-gray-200');
            });
        }
        
        // Handle image upload
        document.getElementById('logoImageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ­ÙŠØ­!', 'error');
                return;
            }
            
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Create canvas to resize image if needed
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Set max dimensions
                    const maxWidth = 200;
                    const maxHeight = 200;
                    
                    let { width, height } = img;
                    
                    // Calculate new dimensions
                    if (width > height) {
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress image
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to base64 with compression
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Update selection
                    selectedImageData = compressedDataUrl;
                    selectedLogoType = 'image';
                    selectedLogo = '';
                    
                    // Update UI
                    document.getElementById('uploadedImagePreview').src = compressedDataUrl;
                    document.getElementById('uploadArea').classList.add('hidden');
                    document.getElementById('imagePreviewArea').classList.remove('hidden');
                    
                    updateLogoPreview();
                    
                    // Clear other selections
                    document.getElementById('customLogo').value = '';
                    document.querySelectorAll('.logo-option').forEach(option => {
                        option.classList.remove('border-purple-500', 'bg-purple-50');
                        option.classList.add('border-gray-200');
                    });
                    
                    showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const resetModal = document.getElementById('resetModal');
            const logoModal = document.getElementById('logoModal');
            
            if (event.target === resetModal) {
                closeResetModal();
            } else if (event.target === logoModal) {
                closeLogoModal();
            }
        }

        // Render monthly statistics
        function renderMonthlyStats() {
            const monthlyContainer = document.getElementById('monthlyStats');
            
            // Calculate monthly statistics
            const monthlyStats = {};
            transactions.forEach(transaction => {
                const date = new Date(transaction.timestamp);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const monthName = `${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;
                
                if (!monthlyStats[monthKey]) {
                    monthlyStats[monthKey] = {
                        monthName: monthName,
                        deliveries: 0,
                        deliveriesAmount: 0,
                        subscriptions: 0,
                        subscriptionsAmount: 0,
                        expenses: 0,
                        expensesAmount: 0,
                        total: 0
                    };
                }
                
                if (transaction.type === 'income') {
                    if (transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ')) {
                        monthlyStats[monthKey].subscriptions++;
                        monthlyStats[monthKey].subscriptionsAmount += transaction.amount;
                    } else {
                        monthlyStats[monthKey].deliveries++;
                        monthlyStats[monthKey].deliveriesAmount += transaction.amount;
                    }
                } else if (transaction.type === 'expense') {
                    monthlyStats[monthKey].expenses++;
                    monthlyStats[monthKey].expensesAmount += transaction.amount;
                }
                
                monthlyStats[monthKey].total = monthlyStats[monthKey].deliveriesAmount + 
                                               monthlyStats[monthKey].subscriptionsAmount - 
                                               monthlyStats[monthKey].expensesAmount;
            });
            
            const months = Object.keys(monthlyStats).sort().reverse(); // Most recent first
            
            if (months.length === 0) {
                monthlyContainer.innerHTML = `
                    <div class="text-center text-gray-500 col-span-full">
                        <div class="text-6xl mb-4">ğŸ“Š</div>
                        <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø±ÙŠØ© Ø¨Ø¹Ø¯</p>
                        <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                    </div>
                `;
                return;
            }
            
            monthlyContainer.innerHTML = months.map((monthKey, index) => {
                const stats = monthlyStats[monthKey];
                const colors = [
                    'from-blue-500 to-cyan-600',
                    'from-green-500 to-emerald-600', 
                    'from-purple-500 to-violet-600',
                    'from-orange-500 to-red-600',
                    'from-pink-500 to-rose-600',
                    'from-indigo-500 to-blue-600',
                    'from-teal-500 to-cyan-600',
                    'from-amber-500 to-orange-600'
                ];
                const colorClass = colors[index % colors.length];
                
                return `
                    <div class="stats-card bg-gradient-to-br ${colorClass} rounded-xl p-6 text-white card-hover shadow-xl">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">ğŸ“…</span>
                            </div>
                            <h4 class="text-lg font-bold mb-4">${stats.monthName}</h4>
                            <div class="space-y-3">
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-white/80 text-sm">ğŸšš Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</span>
                                        <span class="text-white font-bold">${stats.deliveries}</span>
                                    </div>
                                    <p class="text-lg font-bold">${stats.deliveriesAmount.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-white/80 text-sm">ğŸ’ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
                                        <span class="text-white font-bold">${stats.subscriptions}</span>
                                    </div>
                                    <p class="text-lg font-bold">${stats.subscriptionsAmount.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-white/80 text-sm">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
                                        <span class="text-white font-bold">${stats.expenses}</span>
                                    </div>
                                    <p class="text-lg font-bold">${stats.expensesAmount.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                                <div class="bg-white/20 rounded-lg p-3 border-2 border-white/30">
                                    <p class="text-white/90 text-sm mb-1">ğŸ’° Ø§Ù„ØµØ§ÙÙŠ</p>
                                    <p class="text-xl font-bold ${stats.total >= 0 ? 'text-green-200' : 'text-red-200'}">${stats.total.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render agents statistics
        function renderAgentsStats() {
            const agentsContainer = document.getElementById('agentsStats');
            
            // Calculate agent statistics
            const agentStats = {};
            transactions.forEach(transaction => {
                if (transaction.type === 'income' && transaction.agent && !transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ')) {
                    if (!agentStats[transaction.agent]) {
                        agentStats[transaction.agent] = {
                            name: transaction.agent,
                            deliveries: 0,
                            totalAmount: 0
                        };
                    }
                    agentStats[transaction.agent].deliveries++;
                    agentStats[transaction.agent].totalAmount += transaction.amount;
                }
            });
            
            const agents = Object.values(agentStats);
            
            if (agents.length === 0) {
                agentsContainer.innerHTML = `
                    <div class="text-center text-gray-500 col-span-full">
                        <div class="text-6xl mb-4">ğŸ‘¤</div>
                        <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø¨Ø¹Ø¯</p>
                        <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ ÙˆØµÙ„ Ù„Ù…Ù†Ø¯ÙˆØ¨</p>
                    </div>
                `;
                return;
            }
            
            // Sort agents by number of deliveries (descending)
            agents.sort((a, b) => b.deliveries - a.deliveries);
            
            agentsContainer.innerHTML = agents.map((agent, index) => {
                const colors = [
                    'from-blue-500 to-cyan-600',
                    'from-green-500 to-emerald-600', 
                    'from-purple-500 to-violet-600',
                    'from-orange-500 to-red-600',
                    'from-pink-500 to-rose-600',
                    'from-indigo-500 to-blue-600'
                ];
                const colorClass = colors[index % colors.length];
                
                const avgPerDelivery = agent.totalAmount / agent.deliveries;
                
                return `
                    <div class="stats-card bg-gradient-to-br ${colorClass} rounded-xl p-6 text-white card-hover shadow-xl">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">ğŸšš</span>
                            </div>
                            <h4 class="text-xl font-bold mb-2">${agent.name}</h4>
                            <div class="space-y-2">
                                <div class="bg-white/10 rounded-lg p-3">
                                    <p class="text-white/80 text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØµÙˆÙ„Ø§Øª</p>
                                    <p class="text-2xl font-bold">${agent.deliveries}</p>
                                </div>
                                <div class="bg-white/10 rounded-lg p-3">
                                    <p class="text-white/80 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</p>
                                    <p class="text-lg font-bold">${agent.totalAmount.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                                <div class="bg-white/10 rounded-lg p-3">
                                    <p class="text-white/80 text-sm">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØµÙ„</p>
                                    <p class="text-lg font-bold">${Math.round(avgPerDelivery).toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add income with complete validation
        document.getElementById('incomeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const amount = getNumericValue(document.getElementById('incomeAmount'));
            const agent = document.getElementById('deliveryAgent').value.trim();
            const description = document.getElementById('incomeDescription').value.trim();
            
            // Check if all fields are filled
            if (!amount || amount <= 0) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ù„Ù„ÙˆØµÙ„!', 'error');
                document.getElementById('incomeAmount').focus();
                return;
            }
            
            if (!agent) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨!', 'error');
                document.getElementById('deliveryAgent').focus();
                return;
            }
            
            if (!description) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„!', 'error');
                document.getElementById('incomeDescription').focus();
                return;
            }
            
            // Check if receipt number already exists
            const existingReceipt = transactions.find(transaction => 
                transaction.type === 'income' && 
                !transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ') &&
                transaction.description === description
            );
            
            if (existingReceipt) {
                showNotification(`âŒ Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„ ${description} Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹! ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… ÙˆØµÙ„ Ù…Ø®ØªÙ„Ù.`, 'error');
                document.getElementById('incomeDescription').focus();
                document.getElementById('incomeDescription').select();
                return;
            }
            
            const transaction = {
                id: Date.now(),
                type: 'income',
                amount: amount,
                agent: agent,
                description: description,
                date: new Date().toLocaleDateString('ar-EG'),
                timestamp: new Date()
            };
            
            transactions.unshift(transaction);
            saveData();
            calculateTotals();
            updateDisplay();
            renderTransactions();
            renderMonthlyStats();
            renderAgentsStats();
            
            // Check for achievements after adding
            setTimeout(() => {
                checkSmartNotifications();
            }, 1000);
            
            showNotification(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„ Ø±Ù‚Ù… ${description} Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ ${agent} Ø¨Ù‚ÙŠÙ…Ø© ${amount.toLocaleString()} Ø¯.Ø¹ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            this.reset();
        });

        // Add subscription
        document.getElementById('subscriptionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const amount = getNumericValue(document.getElementById('subscriptionAmount'));
            const name = document.getElementById('subscriptionName').value;
            
            const transaction = {
                id: Date.now(),
                type: 'income',
                amount: amount,
                description: `Ø§Ø´ØªØ±Ø§Ùƒ ${name}`,
                date: new Date().toLocaleDateString('ar-EG'),
                timestamp: new Date()
            };
            
            transactions.unshift(transaction);
            saveData();
            calculateTotals();
            updateDisplay();
            renderTransactions();
            renderMonthlyStats();
            
            showNotification(`ğŸ”„ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ ${name} Ø¨Ù‚ÙŠÙ…Ø© ${amount.toLocaleString()} Ø¯.Ø¹!`, 'info');
            this.reset();
        });

        // Add expense
        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const amount = getNumericValue(document.getElementById('expenseAmount'));
            const description = document.getElementById('expenseDescription').value;
            const category = document.getElementById('expenseCategory').value;
            
            const transaction = {
                id: Date.now(),
                type: 'expense',
                amount: amount,
                description: `${description} (${category})`,
                category: category,
                date: new Date().toLocaleDateString('ar-EG'),
                timestamp: new Date()
            };
            
            transactions.unshift(transaction);
            saveData();
            calculateTotals();
            updateDisplay();
            renderTransactions();
            renderMonthlyStats();
            
            // Check warnings after adding expense
            setTimeout(() => {
                checkWarnings();
            }, 500);
            
            showNotification(`ğŸ’¸ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¨Ù‚ÙŠÙ…Ø© ${amount.toLocaleString()} Ø¯.Ø¹ ÙÙŠ ÙØ¦Ø© ${category}!`, 'error');
            this.reset();
        });

        // Calculate totals
        function calculateTotals() {
            totals = {
                income: 0,
                expenses: 0,
                subscriptions: 0
            };
            
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    if (transaction.description.includes('Ø§Ø´ØªØ±Ø§Ùƒ')) {
                        totals.subscriptions += transaction.amount;
                    } else {
                        totals.income += transaction.amount;
                    }
                } else if (transaction.type === 'expense') {
                    totals.expenses += transaction.amount;
                }
            });
        }

        // Update display
        function updateDisplay() {
            document.getElementById('totalIncome').textContent = `${totals.income.toLocaleString()} Ø¯.Ø¹`;
            document.getElementById('totalExpenses').textContent = `${totals.expenses.toLocaleString()} Ø¯.Ø¹`;
            document.getElementById('totalSubscriptions').textContent = `${totals.subscriptions.toLocaleString()} Ø¯.Ø¹`;
            
            const netBalance = totals.income + totals.subscriptions - totals.expenses;
            const netBalanceElement = document.getElementById('netBalance');
            netBalanceElement.textContent = `${netBalance.toLocaleString()} Ø¯.Ø¹`;
            
            // Change color based on balance
            const balanceCard = netBalanceElement.closest('.stats-card');
            if (netBalance >= 0) {
                balanceCard.className = balanceCard.className.replace(/from-\w+-\d+ to-\w+-\d+/, 'from-cyan-500 to-blue-600');
            } else {
                balanceCard.className = balanceCard.className.replace(/from-\w+-\d+ to-\w+-\d+/, 'from-red-500 to-rose-600');
            }
        }

        // Render transactions
        function renderTransactions() {
            const tbody = document.getElementById('transactionsTable');
            
            if (transactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <div class="text-6xl mb-4">ğŸ“‹</div>
                                <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø§Ù„ÙŠØ© Ø¨Ø¹Ø¯</p>
                                <p class="text-gray-400 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù…Ø§Ù„ÙŠØ©</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = transactions.map(transaction => {
                const typeInfo = {
                    income: { icon: 'ğŸšš', text: 'ÙˆØµÙ„', class: 'text-green-600 bg-green-50' },
                    expense: { icon: 'ğŸ’¸', text: 'Ù…ØµØ±ÙˆÙ', class: 'text-red-600 bg-red-50' },
                    subscription: { icon: 'ğŸ”„', text: 'Ø§Ø´ØªØ±Ø§Ùƒ', class: 'text-purple-600 bg-purple-50' }
                };
                
                const info = typeInfo[transaction.type];
                
                return `
                    <tr class="table-row border-b border-gray-100 hover:shadow-lg">
                        <td class="px-6 py-4 text-gray-700 font-medium">${transaction.date}</td>
                        <td class="px-6 py-4">
                            <span class="${info.class} px-3 py-2 rounded-full font-bold text-sm">
                                ${info.icon} ${info.text}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-700 font-medium">${transaction.agent || '-'}</td>
                        <td class="px-6 py-4 text-gray-700 font-medium">${transaction.description}</td>
                        <td class="px-6 py-4 font-bold text-lg ${info.class.split(' ')[0]}">${transaction.amount.toLocaleString()} Ø¯.Ø¹</td>
                    </tr>
                `;
            }).join('');
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        // Format number with commas as user types
        function formatNumberInput(input) {
            // Get cursor position
            let cursorPosition = input.selectionStart;
            
            // Remove all non-digit characters
            let value = input.value.replace(/[^\d]/g, '');
            
            // Don't format if empty
            if (!value) {
                input.value = '';
                return;
            }
            
            // Add commas every 3 digits from right to left
            let formattedValue = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // Count commas before cursor
            let beforeCursor = input.value.substring(0, cursorPosition);
            let commasBeforeCursor = (beforeCursor.match(/,/g) || []).length;
            
            // Update input value
            input.value = formattedValue;
            
            // Calculate new cursor position
            let digitsBeforeCursor = beforeCursor.replace(/[^\d]/g, '').length;
            let newCommasBeforeCursor = 0;
            let digitCount = 0;
            
            for (let i = 0; i < formattedValue.length; i++) {
                if (formattedValue[i] === ',') {
                    newCommasBeforeCursor++;
                } else {
                    digitCount++;
                    if (digitCount >= digitsBeforeCursor) {
                        break;
                    }
                }
            }
            
            let newCursorPosition = digitsBeforeCursor + newCommasBeforeCursor;
            input.setSelectionRange(newCursorPosition, newCursorPosition);
        }

        // Get numeric value from formatted input
        function getNumericValue(input) {
            return parseFloat(input.value.replace(/,/g, '')) || 0;
        }

        // Add event listeners for number formatting
        document.addEventListener('DOMContentLoaded', function() {
            const numberInputs = ['incomeAmount', 'subscriptionAmount', 'expenseAmount'];
            
            numberInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                
                // Only allow numbers and commas
                input.addEventListener('keypress', function(e) {
                    // Allow backspace, delete, tab, escape, enter
                    if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                        // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                        (e.keyCode === 65 && e.ctrlKey === true) ||
                        (e.keyCode === 67 && e.ctrlKey === true) ||
                        (e.keyCode === 86 && e.ctrlKey === true) ||
                        (e.keyCode === 88 && e.ctrlKey === true)) {
                        return;
                    }
                    // Ensure that it is a number and stop the keypress
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
                
                // Format on input
                input.addEventListener('input', function() {
                    formatNumberInput(this);
                });
                
                // Handle paste events
                input.addEventListener('paste', function(e) {
                    setTimeout(() => {
                        formatNumberInput(this);
                    }, 10);
                });
            });

            // Add number-only restriction for receipt number field
            const receiptNumberInput = document.getElementById('incomeDescription');
            receiptNumberInput.addEventListener('keypress', function(e) {
                // Allow backspace, delete, tab, escape, enter
                if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                    // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true)) {
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

            // Handle paste events for receipt number
            receiptNumberInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    // Remove any non-digit characters from pasted content
                    this.value = this.value.replace(/[^\d]/g, '');
                }, 10);
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b5a6d222a94d91',t:'MTc1NzI0MjI5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
